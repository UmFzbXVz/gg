<!DOCTYPE html>
<html lang="da">
	<head>
		<meta charset="UTF-8">
		<title>Kvit og Frit</title>
		<link rel="stylesheet" href="style.css">
		<link rel="icon" type="image/png" href="favicon.png">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	</head>
	<body>
		<div class="page-container">
			<h1>
				<span class="gg-highlight">Kvit og Frit</span>
			</h1>
			<form id="searchForm" class="controls">
				<div class="input-wrapper">
					<input type="text" id="searchTerm" placeholder="søg efter..." autocomplete="off">
					<div class="spinner" id="loadingSpinner"></div>
				</div>
			</form>
			<div id="grid"></div>
		</div>
		<script src="scripts/gg-search.js"></script>
		<script src="scripts/dba-search.js"></script>
<script>
(() => {
    const form = document.getElementById("searchForm");
    const input = document.getElementById("searchTerm");
    const grid = document.getElementById("grid");
    const spinner = document.getElementById("loadingSpinner");
    
    let isFirstSearch = true;
    window.allCards = [];
    
    function showNoResults(term) {
        if (window.allCards.length === 0) { 
            grid.innerHTML = `<div class="no-results">0 søgeresultater for "<strong>${term}</strong>".</div>`;
        }
    }

    window.sortAndRender = function() {
        window.allCards.sort((a, b) => b.dataset.timestamp - a.dataset.timestamp);
        grid.innerHTML = "";
        window.allCards.forEach(card => grid.appendChild(card));
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const term = input.value.trim();
        if (!term) return;

        input.disabled = true;
        spinner.classList.add("active");

        if (isFirstSearch) {
            grid.innerHTML = "";
            isFirstSearch = false;
        }

        window.allCards = []; 

        const ggPromise = window.hentOgVisGG(term);
        const dbaPromise = window.hentOgVisDBA(term);

        try {
            await Promise.all([ggPromise, dbaPromise]);
            window.sortAndRender();  
            showNoResults(term);
        } catch (err) {
            console.error("Fejl i søgning:", err);
        } finally {
            input.disabled = false;
            spinner.classList.remove("active");
        }
    });
})();
</script>

	</body>
</html>
